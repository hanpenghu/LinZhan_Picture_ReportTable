<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winwin.picreport.Ddao.reportxmlmapper.A001TongYongMapper">
    <!--<resultMap id="BaseResultMap" type=""></resultMap>-->
    <resultMap id="PrdtSampBaseResultMap" type="com.winwin.picreport.Edto.PrdtSamp">
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="prd_code" jdbcType="VARCHAR" property="prdCode" />
        <result column="idx_name" jdbcType="VARCHAR" property="idxName" />
        <result column="idx_no" jdbcType="VARCHAR" property="idxNo" />
        <result column="mark_name" jdbcType="VARCHAR" property="markName" />
        <result column="mark_no" jdbcType="VARCHAR" property="markNo" />
        <result column="colour" jdbcType="VARCHAR" property="colour" />
        <result column="size" jdbcType="VARCHAR" property="size" />
        <result column="sal_name" jdbcType="VARCHAR" property="salName" />
        <result column="sal_no" jdbcType="VARCHAR" property="salNo" />
        <result column="cus_no" jdbcType="VARCHAR" property="cusNo" />
        <result column="cus_name" jdbcType="VARCHAR" property="cusName" />
        <result column="isFenJie" jdbcType="VARCHAR" property="isfenjie" />
        <result column="samp_make" jdbcType="TIMESTAMP" property="sampMake" />
        <result column="samp_send" jdbcType="TIMESTAMP" property="sampSend" />
        <result column="samp_requ" jdbcType="VARCHAR" property="sampRequ" />
        <result column="samp_desc" jdbcType="VARCHAR" property="sampDesc" />
        <result column="thum" jdbcType="VARCHAR" property="thum" />
        <result column="attach" jdbcType="VARCHAR" property="attach" />
        <result column="insertdate" jdbcType="TIMESTAMP" property="insertdate" />
        <result column="confirmMan" jdbcType="VARCHAR" property="confirmman" />
        <result column="confirmTimeStr" jdbcType="VARCHAR" property="confirmtimestr" />
        <result column="isConfirm" jdbcType="INTEGER" property="isconfirm" />
        <result column="Category" jdbcType="VARCHAR" property="category" />
        <result column="TeamName" jdbcType="VARCHAR" property="teamname" />
        <result column="confirmRem" jdbcType="VARCHAR" property="confirmrem" />
        <result column="unit" jdbcType="VARCHAR" property="unit" />
        <result column="businessDesc" jdbcType="VARCHAR" property="businessdesc" />
        <result column="financeDesc" jdbcType="VARCHAR" property="financedesc" />
        <result column="startSellCount" jdbcType="NUMERIC" property="startsellcount" />
        <result column="modelCost" jdbcType="NUMERIC" property="modelcost" />
        <result column="estimatePrice" jdbcType="NUMERIC" property="estimateprice" />
        <result column="littleOrderPrice" jdbcType="NUMERIC" property="littleorderprice" />
    </resultMap>

    <sql id="PrdtSampBase_Column_List">
        id, prd_code, idx_name, idx_no, mark_name, mark_no, colour, size, sal_name, sal_no,
        cus_no, cus_name, isFenJie, samp_make, samp_send, samp_requ, samp_desc, thum, attach,
        insertdate, confirmMan, confirmTimeStr, isConfirm, Category, TeamName, confirmRem,
        unit, businessDesc, financeDesc, startSellCount, modelCost, estimatePrice, littleOrderPrice
    </sql>
    <!-- 产品打样列表多条件查询的条件-->
    <sql id="productProofWithManyCondition">
        (
                insertDate
                BETWEEN
                <choose>
                    <when test="insertdateStr != null and insertdateStr != ''">
                        #{insertdateStr}
                    </when>
                    <otherwise>
                        '1970-01-01'
                    </otherwise>
                </choose>
                AND
                <choose>
                    <when test="insertdateStrEnd != null and insertdateStrEnd != ''">
                        #{insertdateStrEnd}
                    </when>
                    <otherwise>
                        '9999-01-01'
                    </otherwise>
                </choose>
        )
        AND
        (
                    confirmTimeStr
                    BETWEEN
                    <choose>
                        <when test="confirmtimestr != null and confirmtimestr != ''">
                            #{confirmtimestr}
                        </when>
                        <otherwise>
                            '1970-01-01'
                        </otherwise>
                    </choose>
                    AND
                    <choose>
                        <when test="confirmtimestrEnd != null and confirmtimestrEnd != ''">
                            #{confirmtimestrEnd}
                        </when>
                        <otherwise>
                            '9999-01-01'
                        </otherwise>
                    </choose>
        )
        AND
                    --产品名称
                    idx_Name=
                    <choose>
                        <when test="idxName = null or idxName = ''">
                            idx_Name
                        </when>
                        <otherwise>
                            #{idxName}
                        </otherwise>
                    </choose>


        AND
        ---产品分类
                    idx_No=
                    <choose>
                        <when test="idxNo = null or idxNo = ''">
                            idx_No
                        </when>
                        <otherwise>
                            #{idxNo}
                        </otherwise>
                    </choose>
        AND
        --产品编码
                    prd_Code=
                    <choose>
                        <when test="prdCode = null or prdCode = ''">
                            prd_Code
                        </when>
                        <otherwise>
                            #{prdCode}
                        </otherwise>
                    </choose>

        AND
                    --产品负责人
                    sal_No=
                    <choose>
                        <when test="salNo = null or salNo = ''">
                            sal_No
                        </when>
                        <otherwise>
                            #{salNo}
                        </otherwise>
                    </choose>
        AND
        --是否已经打样确认
        isConfirm=
        <choose>
            <when test="isconfirm = null">
                isConfirm
            </when>
            <otherwise>
                #{isconfirm}
            </otherwise>
        </choose>
    </sql>

    <!--登录验证用的  得到修改跟人信息接口 -->
    <select id="selectUserEditInfo" resultType="com.winwin.picreport.Edto.LoginInfo">
          Select
            u.tenantid AS 'tenantId'
            ,u.userEmail AS 'userEmail'
            ,u.userPswd AS 'userPswd'
            ,u.phone_no AS 'phoneNo'
            ,u.user_name AS 'userName'
            ,t.tenantName AS 'tenantName'
            from   users u,tenant t where t.tenantid=u.tenantid
            ---下一句话的意思是: 至少有一个不是space或者null
            and (isnull(u.userEmail,'')!='' or   isnull(u.phone_no,'')!='' or  isnull(u.user_name,'')!='')
            and isnull(u.tenantid,'')=#{info.tenantId}
            and isnull(t.tenantid,'')=#{info.tenantId}
            and
            (
                isnull(u.userEmail,'')=#{info.userEmail}
                or isnull(u.phone_no,'')=#{info.phoneNo}
                or isnull(u.user_name,'')=#{info.userName}
            )

    </select>


    <!-- 修改个人信息用的sql -->
    <update id="updateUserInfo" parameterType="com.winwin.picreport.Edto.LoginInfo">
        UPDATE USERS
            SET
                <if test="newUserEamil != null and newUserEamil !='' and newUserEamil != 'undefined' " >
                   userEmail=#{newUserEamil},
                </if>
                <if test="newUserPswd != null and newUserPswd !='' and newUserPswd != 'undefined' " >
                  userPswd=#{newUserPswd},
                </if>
                <if test="newPhoneNo != null and newPhoneNo !='' and newPhoneNo != 'undefined' " >
                    phone_no=#{newPhoneNo},
                </if>
                <if test="newUserName != 'undefined' and newUserName != null and newUserName !='' ">
                    user_name=#{newUserName},  ---注意,这里有undifined的时候,会正题插不进去,因为这一行不要了,上面一行多了个逗号跟where搞在一起了
                </if>
                timetoken=timetoken   ---这个主要是解决最后一个if是null的时候报错的问题
            where
            ---下一句话的意思是: 至少有一个不是space或者null
            (isnull(userEmail,'')!='' or   isnull(phone_no,'')!='' or  isnull(user_name,'')!='')
            and isnull(tenantid,'')=#{tenantId}
            and
            (
                isnull(userEmail,'')=#{userEmail}
                or isnull(phone_no,'')=#{phoneNo}
                or isnull(user_name,'')=#{userName}
            )
    </update>







    <!-- 产品打样列表多条件查询-->
    <select id="chanPinBianMaJianDangTiaoJianChaXun" resultMap="PrdtSampBaseResultMap">
        SELECT
        TOP
        (#{meiYeXianShiShu})
        <include refid="PrdtSampBase_Column_List" />
        FROM
        PRDT_SAMP
        WHERE
        id NOT IN
        (
            select top
            (
                (#{meiYeXianShiShu})*((#{dangQianYe})-1)
            )id from PRDT_SAMP
            WHERE
             <!-- 产品打样列表多条件查询的条件-->
              <include refid="productProofWithManyCondition"/>
              ORDER BY samp_make DESC
        )
        AND
        <!-- 产品打样列表多条件查询的条件-->
        <include refid="productProofWithManyCondition"/>
        ORDER BY samp_make DESC
    </select>











































    <!--&lt;!&ndash; 产品打样列表多条件查询&ndash;&gt;-->
    <!--<select id="chanPinBianMaJianDangTiaoJianChaXun" resultMap="PrdtSampBaseResultMap">-->
    <!--SELECT-->
    <!--TOP-->
    <!--(#{meiYeXianShiShu})-->
    <!--<include refid="PrdtSampBase_Column_List" />-->
    <!--FROM-->
    <!--PRDT_SAMP-->
    <!--WHERE-->
    <!--id NOT IN-->
    <!--(-->
    <!--select top-->
    <!--(-->
    <!--(#{meiYeXianShiShu})*((#{dangQianYe})-1)-->
    <!--)-->
    <!--id from PRDT_SAMP-->
    <!--WHERE-->
    <!--(-->
    <!--insertDate-->
    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStr}=NULL THEN '1970-01-01'-&#45;&#45;注意,这个null其实喘不过来,需要将null变成''才能穿过来-->
    <!--WHEN #{insertdateStr}='' THEN '1970-01-01'-->
    <!--ELSE #{insertdateStr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStrEnd}=NULL THEN '9999-01-01'-->
    <!--WHEN #{insertdateStrEnd}='' THEN '9999-01-01'-->
    <!--ELSE #{insertdateStrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--confirmTimeStr-->

    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestr}=NULL THEN '1970-01-01'-->
    <!--WHEN #{confirmtimestr}='' THEN '1970-01-01'-->
    <!--ELSE #{confirmtimestr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestrEnd}=NULL THEN '2099-01-01'-->
    <!--WHEN #{confirmtimestrEnd}='' THEN '2099-01-01'-->
    <!--ELSE #{confirmtimestrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品名称-->
    <!--idx_Name=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxName}=NULL THEN idx_Name-->
    <!--WHEN #{idxName}='' THEN idx_Name-->
    <!--ELSE #{idxName}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!-- -&#45;&#45;产品分类-->
    <!--idx_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxNo}=NULL THEN idx_No-->
    <!--WHEN #{idxNo}='' THEN idx_No-->
    <!--ELSE #{idxNo}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品编码-->
    <!--prd_Code=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{prdCode}=NULL THEN prd_Code-->
    <!--WHEN #{prdCode}='' THEN prd_Code-->
    <!--ELSE #{prdCode}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品负责人-->
    <!--sal_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{salNo}=NULL THEN sal_No-->
    <!--WHEN #{salNo}='' THEN sal_No-->
    <!--ELSE #{salNo}-->
    <!--END-->
    <!--)-->



    <!--ORDER BY samp_make DESC-->
    <!--)-->


    <!--AND (-->
    <!--insertDate-->
    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStr}=NULL THEN '1970-01-01'-&#45;&#45;注意,这个null其实喘不过来,需要将null变成''才能穿过来-->
    <!--WHEN #{insertdateStr}='' THEN '1970-01-01'-->
    <!--ELSE #{insertdateStr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStrEnd}=NULL THEN '9999-01-01'-->
    <!--WHEN #{insertdateStrEnd}='' THEN '9999-01-01'-->
    <!--ELSE #{insertdateStrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--confirmTimeStr-->

    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestr}=NULL THEN '1970-01-01'-->
    <!--WHEN #{confirmtimestr}='' THEN '1970-01-01'-->
    <!--ELSE #{confirmtimestr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestrEnd}=NULL THEN '2099-01-01'-->
    <!--WHEN #{confirmtimestrEnd}='' THEN '2099-01-01'-->
    <!--ELSE #{confirmtimestrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品名称-->
    <!--idx_Name=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxName}=NULL THEN idx_Name-->
    <!--WHEN #{idxName}='' THEN idx_Name-->
    <!--ELSE #{idxName}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!-- -&#45;&#45;产品分类-->
    <!--idx_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxNo}=NULL THEN idx_No-->
    <!--WHEN #{idxNo}='' THEN idx_No-->
    <!--ELSE #{idxNo}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品编码-->
    <!--prd_Code=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{prdCode}=NULL THEN prd_Code-->
    <!--WHEN #{prdCode}='' THEN prd_Code-->
    <!--ELSE #{prdCode}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品负责人-->
    <!--sal_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{salNo}=NULL THEN sal_No-->
    <!--WHEN #{salNo}='' THEN sal_No-->
    <!--ELSE #{salNo}-->
    <!--END-->
    <!--)-->


    <!--ORDER BY samp_make DESC-->
    <!--</select>-->

</mapper>
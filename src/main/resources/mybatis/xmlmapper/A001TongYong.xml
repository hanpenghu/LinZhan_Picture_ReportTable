<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winwin.picreport.Ddao.reportxmlmapper.A001TongYongMapper">
    <!--<resultMap id="BaseResultMap" type=""></resultMap>-->
    <!-- 可以继承另一个名称空间的东西-->
    <resultMap id="PrdtSampBaseResultMap"
               extends="com.winwin.picreport.Ddao.reportxmlmapper.PrdtSampMapper.BaseResultMap"
               type="com.winwin.picreport.Edto.PrdtSamp">
    </resultMap>
<!-- sql中的lang是继承的意思,这里明显继承了另一个名称空间的东西-->
    <sql id="PrdtSampBase_Column_List"
         lang="com.winwin.picreport.Ddao.reportxmlmapper.PrdtSampMapper.Base_Column_List" >
    </sql>

    <!-- 产品打样列表多条件查询的条件-->
    <sql id="productProofWithManyCondition">
        (
                insertDate
                BETWEEN
                <choose>
                    <when test="insertdateStr != null and insertdateStr != ''">
                        #{insertdateStr}
                    </when>
                    <otherwise>
                        '1970-01-01'
                    </otherwise>
                </choose>
                AND
                <choose>
                    <when test="insertdateStrEnd != null and insertdateStrEnd != ''">
                        #{insertdateStrEnd}
                    </when>
                    <otherwise>
                        '9999-01-01'
                    </otherwise>
                </choose>
        )
        AND
        (
                    confirmTimeStr
                    BETWEEN
                    <choose>
                        <when test="confirmtimestr != null and confirmtimestr != ''">
                            #{confirmtimestr}
                        </when>
                        <otherwise>
                            '1970-01-01'
                        </otherwise>
                    </choose>
                    AND
                    <choose>
                        <when test="confirmtimestrEnd != null and confirmtimestrEnd != ''">
                            #{confirmtimestrEnd}
                        </when>
                        <otherwise>
                            '9999-01-01'
                        </otherwise>
                    </choose>
        )
        AND
                    --产品名称
                    idx_Name=
                    <choose>
                        <when test="idxName = null or idxName = ''">
                            idx_Name
                        </when>
                        <otherwise>
                            #{idxName}
                        </otherwise>
                    </choose>


        AND
        ---产品分类
                    idx_No=
                    <choose>
                        <when test="idxNo = null or idxNo = ''">
                            idx_No
                        </when>
                        <otherwise>
                            #{idxNo}
                        </otherwise>
                    </choose>
        AND
        --产品编码
                    prd_Code=
                    <choose>
                        <when test="prdCode = null or prdCode = ''">
                            prd_Code
                        </when>
                        <otherwise>
                            #{prdCode}
                        </otherwise>
                    </choose>

        AND
                    --产品负责人
                    sal_No=
                    <choose>
                        <when test="salNo = null or salNo = ''">
                            sal_No
                        </when>
                        <otherwise>
                            #{salNo}
                        </otherwise>
                    </choose>
        AND
        --是否已经打样确认
        isConfirm=
        <choose>
            <when test="isconfirm = null">
                isConfirm
            </when>
            <otherwise>
                #{isconfirm}
            </otherwise>
        </choose>
    </sql>

    <!--登录验证用的  得到修改跟人信息接口 -->
    <select id="selectUserEditInfo" resultType="com.winwin.picreport.Edto.LoginInfo">
          Select
            u.tenantid AS 'tenantId'
            ,u.userEmail AS 'userEmail'
            ,u.userPswd AS 'userPswd'
            ,u.phone_no AS 'phoneNo'
            ,u.user_name AS 'userName'
            ,t.tenantName AS 'tenantName'
            from   users u,tenant t where t.tenantid=u.tenantid
            ---下一句话的意思是: 至少有一个不是space或者null
            and (isnull(u.userEmail,'')!='' or   isnull(u.phone_no,'')!='' or  isnull(u.user_name,'')!='')
            and isnull(u.tenantid,'')=#{info.tenantId}
            and isnull(t.tenantid,'')=#{info.tenantId}
            and
            (
                isnull(u.userEmail,'')=#{info.userEmail}
                or isnull(u.phone_no,'')=#{info.phoneNo}
                or isnull(u.user_name,'')=#{info.userName}
            )

    </select>


    <!-- 修改个人信息用的sql -->
    <update id="updateUserInfo" parameterType="com.winwin.picreport.Edto.LoginInfo">
        UPDATE USERS
            SET
                <if test="newUserEamil != null and newUserEamil !='' and newUserEamil != 'undefined' " >
                   userEmail=#{newUserEamil},
                </if>
                <if test="newUserPswd != null and newUserPswd !='' and newUserPswd != 'undefined' " >
                  userPswd=#{newUserPswd},
                </if>
                <if test="newPhoneNo != null and newPhoneNo !='' and newPhoneNo != 'undefined' " >
                    phone_no=#{newPhoneNo},
                </if>
                <if test="newUserName != 'undefined' and newUserName != null and newUserName !='' ">
                    user_name=#{newUserName},  ---注意,这里有undifined的时候,会正题插不进去,因为这一行不要了,上面一行多了个逗号跟where搞在一起了
                </if>
                timetoken=timetoken   ---这个主要是解决最后一个if是null的时候报错的问题
            where
            ---下一句话的意思是: 至少有一个不是space或者null
            (isnull(userEmail,'')!='' or   isnull(phone_no,'')!='' or  isnull(user_name,'')!='')
            and isnull(tenantid,'')=#{tenantId}
            and
            (
                isnull(userEmail,'')=#{userEmail}
                or isnull(phone_no,'')=#{phoneNo}
                or isnull(user_name,'')=#{userName}
            )
    </update>







    <!-- 产品打样列表多条件查询-->
    <select id="chanPinBianMaJianDangTiaoJianChaXun" resultMap="PrdtSampBaseResultMap">
        SELECT
        TOP
        (#{meiYeXianShiShu})
        <include refid="PrdtSampBase_Column_List" />
        FROM
        PRDT_SAMP
        WHERE
        id NOT IN
        (
            select top
            (
                (#{meiYeXianShiShu})*((#{dangQianYe})-1)
            )id from PRDT_SAMP
            WHERE
             <!-- 产品打样列表多条件查询的条件-->
              <include refid="productProofWithManyCondition"/>
              ORDER BY samp_make DESC
        )
        AND
        <!-- 产品打样列表多条件查询的条件-->
        <include refid="productProofWithManyCondition"/>
        ORDER BY samp_make DESC
    </select>











































    <!--&lt;!&ndash; 产品打样列表多条件查询&ndash;&gt;-->
    <!--<select id="chanPinBianMaJianDangTiaoJianChaXun" resultMap="PrdtSampBaseResultMap">-->
    <!--SELECT-->
    <!--TOP-->
    <!--(#{meiYeXianShiShu})-->
    <!--<include refid="PrdtSampBase_Column_List" />-->
    <!--FROM-->
    <!--PRDT_SAMP-->
    <!--WHERE-->
    <!--id NOT IN-->
    <!--(-->
    <!--select top-->
    <!--(-->
    <!--(#{meiYeXianShiShu})*((#{dangQianYe})-1)-->
    <!--)-->
    <!--id from PRDT_SAMP-->
    <!--WHERE-->
    <!--(-->
    <!--insertDate-->
    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStr}=NULL THEN '1970-01-01'-&#45;&#45;注意,这个null其实喘不过来,需要将null变成''才能穿过来-->
    <!--WHEN #{insertdateStr}='' THEN '1970-01-01'-->
    <!--ELSE #{insertdateStr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStrEnd}=NULL THEN '9999-01-01'-->
    <!--WHEN #{insertdateStrEnd}='' THEN '9999-01-01'-->
    <!--ELSE #{insertdateStrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--confirmTimeStr-->

    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestr}=NULL THEN '1970-01-01'-->
    <!--WHEN #{confirmtimestr}='' THEN '1970-01-01'-->
    <!--ELSE #{confirmtimestr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestrEnd}=NULL THEN '2099-01-01'-->
    <!--WHEN #{confirmtimestrEnd}='' THEN '2099-01-01'-->
    <!--ELSE #{confirmtimestrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品名称-->
    <!--idx_Name=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxName}=NULL THEN idx_Name-->
    <!--WHEN #{idxName}='' THEN idx_Name-->
    <!--ELSE #{idxName}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!-- -&#45;&#45;产品分类-->
    <!--idx_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxNo}=NULL THEN idx_No-->
    <!--WHEN #{idxNo}='' THEN idx_No-->
    <!--ELSE #{idxNo}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品编码-->
    <!--prd_Code=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{prdCode}=NULL THEN prd_Code-->
    <!--WHEN #{prdCode}='' THEN prd_Code-->
    <!--ELSE #{prdCode}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品负责人-->
    <!--sal_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{salNo}=NULL THEN sal_No-->
    <!--WHEN #{salNo}='' THEN sal_No-->
    <!--ELSE #{salNo}-->
    <!--END-->
    <!--)-->



    <!--ORDER BY samp_make DESC-->
    <!--)-->


    <!--AND (-->
    <!--insertDate-->
    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStr}=NULL THEN '1970-01-01'-&#45;&#45;注意,这个null其实喘不过来,需要将null变成''才能穿过来-->
    <!--WHEN #{insertdateStr}='' THEN '1970-01-01'-->
    <!--ELSE #{insertdateStr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{insertdateStrEnd}=NULL THEN '9999-01-01'-->
    <!--WHEN #{insertdateStrEnd}='' THEN '9999-01-01'-->
    <!--ELSE #{insertdateStrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--confirmTimeStr-->

    <!--BETWEEN-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestr}=NULL THEN '1970-01-01'-->
    <!--WHEN #{confirmtimestr}='' THEN '1970-01-01'-->
    <!--ELSE #{confirmtimestr}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{confirmtimestrEnd}=NULL THEN '2099-01-01'-->
    <!--WHEN #{confirmtimestrEnd}='' THEN '2099-01-01'-->
    <!--ELSE #{confirmtimestrEnd}-->
    <!--END-->
    <!--)-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品名称-->
    <!--idx_Name=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxName}=NULL THEN idx_Name-->
    <!--WHEN #{idxName}='' THEN idx_Name-->
    <!--ELSE #{idxName}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!-- -&#45;&#45;产品分类-->
    <!--idx_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{idxNo}=NULL THEN idx_No-->
    <!--WHEN #{idxNo}='' THEN idx_No-->
    <!--ELSE #{idxNo}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品编码-->
    <!--prd_Code=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{prdCode}=NULL THEN prd_Code-->
    <!--WHEN #{prdCode}='' THEN prd_Code-->
    <!--ELSE #{prdCode}-->
    <!--END-->
    <!--)-->
    <!--AND-->
    <!--&#45;&#45;产品负责人-->
    <!--sal_No=-->
    <!--(-->
    <!--CASE-->
    <!--WHEN #{salNo}=NULL THEN sal_No-->
    <!--WHEN #{salNo}='' THEN sal_No-->
    <!--ELSE #{salNo}-->
    <!--END-->
    <!--)-->


    <!--ORDER BY samp_make DESC-->
    <!--</select>-->

</mapper>
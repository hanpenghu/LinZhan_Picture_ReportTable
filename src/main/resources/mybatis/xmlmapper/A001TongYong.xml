<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winwin.picreport.Ddao.reportxmlmapper.A001TongYongMapper">
    <!--<resultMap id="BaseResultMap" type=""></resultMap>-->
    <!-- 可以继承另一个名称空间的东西-->
    <resultMap id="PrdtSampBaseResultMap"
               extends="com.winwin.picreport.Ddao.reportxmlmapper.PrdtSampMapper.BaseResultMap"
               type="com.winwin.picreport.Edto.PrdtSamp">
    </resultMap>

    <!--添加查询模块给所有返回信息
    //    //销售价格列表
//    List<UpDefMy>upDefMyListSale=new ArrayList<>();
//    //采购价格列表
//    List<UpDefMy>upDefMyListByer=new ArrayList<>();
    -->
    <resultMap id="UpDefMyBaseResultMap" type="com.winwin.picreport.Edto.UpDefMy">
        <id column="CUR_ID" jdbcType="VARCHAR" property="curId" />
        <id column="QTY" jdbcType="NUMERIC" property="qty" />
        <id column="S_DD" jdbcType="TIMESTAMP" property="sDd" />
        <result column="UP" jdbcType="NUMERIC" property="up" />
        <result column="UNIT" jdbcType="VARCHAR" property="unit" />
        <result column="name" jdbcType="VARCHAR" property="curName" />
    </resultMap>
   <!-- <sql id="PrdtSampBase_Column_List">
        id, prd_code, idx_name, idx_no, mark_name, mark_no, colour, size, sal_name, sal_no,
        cus_no, cus_name, isFenJie, samp_make, samp_send, samp_requ, samp_desc, thum, attach,
        insertdate, confirmMan, confirmTimeStr, isConfirm, Category, TeamName, confirmRem,
        unit, businessDesc, financeDesc, startSellCount, modelCost, estimatePrice, littleOrderPrice
    </sql>-->
    <!-- 产品打样列表多条件查询的条件-->
    <sql id="productProofWithManyCondition">
        (
                insertDate
                BETWEEN
                <choose>
                    <when test="insertdateStr != null and insertdateStr != ''">
                        #{insertdateStr}
                    </when>
                    <otherwise>
                        '1970-01-01'
                    </otherwise>
                </choose>
                AND
                <choose>
                    <when test="insertdateStrEnd != null and insertdateStrEnd != ''">
                        #{insertdateStrEnd}
                    </when>
                    <otherwise>
                        '9999-01-01'
                    </otherwise>
                </choose>
        )
        AND
        (
                    confirmTimeStr
                    BETWEEN
                    <choose>
                        <when test="confirmtimestr != null and confirmtimestr != ''">
                            #{confirmtimestr}
                        </when>
                        <otherwise>
                            '1970-01-01'
                        </otherwise>
                    </choose>
                    AND
                    <choose>
                        <when test="confirmtimestrEnd != null and confirmtimestrEnd != ''">
                            #{confirmtimestrEnd}
                        </when>
                        <otherwise>
                            '9999-01-01'
                        </otherwise>
                    </choose>
        )
        AND(
                        --产品名称
                        idx_Name=
                        <choose>
                            <when test="idxName == null or idxName == ''">
                                idx_Name
                            </when>
                            <otherwise>
                                #{idxName}
                            </otherwise>
                        </choose>


        AND
            ---产品分类
                        idx_No=
                        <choose>
                            <when test="idxNo == null or idxNo == ''">
                                idx_No
                            </when>
                            <otherwise>
                                #{idxNo}
                            </otherwise>
                        </choose>
        )
        AND
        --产品编码
                    prd_Code=
                    <choose>
                        <when test="prdCode == null or prdCode == ''">
                            prd_Code
                        </when>
                        <otherwise>
                            #{prdCode}
                        </otherwise>
                    </choose>

        AND
                    --产品负责人
                    sal_No=
                    <choose>
                        <when test="salNo == null or salNo == ''">
                            sal_No
                        </when>
                        <otherwise>
                            #{salNo}
                        </otherwise>
                    </choose>
        AND
        --是否已经打样确认
        isConfirm=
        <choose>
            <when test="isconfirm == null">
                isConfirm
            </when>
            <otherwise>
                #{isconfirm}
            </otherwise>
        </choose>
    </sql>

    <!--登录验证用的  得到修改跟人信息接口 -->
    <select id="selectUserEditInfo" resultType="com.winwin.picreport.Edto.LoginInfo">
          Select
            u.tenantid AS 'tenantId'
            ,u.userEmail AS 'userEmail'
            ,u.userPswd AS 'userPswd'
            ,u.phone_no AS 'phoneNo'
            ,u.user_name AS 'userName'
            ,t.tenantName AS 'tenantName'
            from   users u,tenant t where t.tenantid=u.tenantid
            ---下一句话的意思是: 至少有一个不是space或者null
            and (isnull(u.userEmail,'')!='' or   isnull(u.phone_no,'')!='' or  isnull(u.user_name,'')!='')
            and isnull(u.tenantid,'')=#{info.tenantId}
            and isnull(t.tenantid,'')=#{info.tenantId}
            and
            (
                isnull(u.userEmail,'')=#{info.userEmail}
                or isnull(u.phone_no,'')=#{info.phoneNo}
                or isnull(u.user_name,'')=#{info.userName}
            )

    </select>


    <!-- 修改个人信息用的sql -->
    <update id="updateUserInfo" parameterType="com.winwin.picreport.Edto.LoginInfo">
        UPDATE USERS
            SET
                <if test="newUserEamil != null and newUserEamil !='' and newUserEamil != 'undefined' " >
                   userEmail=#{newUserEamil},
                </if>
                <if test="newUserPswd != null and newUserPswd !='' and newUserPswd != 'undefined' " >
                  userPswd=#{newUserPswd},
                </if>
                <if test="newPhoneNo != null and newPhoneNo !='' and newPhoneNo != 'undefined' " >
                    phone_no=#{newPhoneNo},
                </if>
                <if test="newUserName != 'undefined' and newUserName != null and newUserName !='' ">
                    user_name=#{newUserName},  ---注意,这里有undifined的时候,会正题插不进去,因为这一行不要了,上面一行多了个逗号跟where搞在一起了
                </if>
                timetoken=timetoken   ---这个主要是解决最后一个if是null的时候报错的问题
            where
            ---下一句话的意思是: 至少有一个不是space或者null
            (isnull(userEmail,'')!='' or   isnull(phone_no,'')!='' or  isnull(user_name,'')!='')
            and isnull(tenantid,'')=#{tenantId}
            and
            (
                isnull(userEmail,'')=#{userEmail}
                or isnull(phone_no,'')=#{phoneNo}
                or isnull(user_name,'')=#{userName}
            )
    </update>







    <!-- 产品打样列表多条件查询-->
    <select id="chanPinBianMaJianDangTiaoJianChaXun" resultMap="PrdtSampBaseResultMap">
        SELECT
        TOP
        (#{meiYeXianShiShu})
        <include refid="com.winwin.picreport.Ddao.reportxmlmapper.PrdtSampMapper.Base_Column_List" />
        FROM
        PRDT_SAMP
        WHERE
        id NOT IN
        (
            select top
            (
                (#{meiYeXianShiShu})*((#{dangQianYe})-1)
            )id from PRDT_SAMP
            WHERE
             <!-- 产品打样列表多条件查询的条件-->
              <include refid="productProofWithManyCondition"/>
              ORDER BY insertdate DESC
        )
        AND
        <!-- 产品打样列表多条件查询的条件-->
        <include refid="productProofWithManyCondition"/>
        ORDER BY insertdate DESC
    </select>


    <!--林展多条件查询接口 -->

    <select id="getCountOfDuoTiaoJianChaXunZongJiLuShu" resultType="java.lang.Integer">
        SELECT count(id)
        FROM  PRDT_SAMP
        WHERE
        <!-- 产品打样列表多条件查询的条件-->
        <include refid="productProofWithManyCondition"/>
    </select>



    <select id="getUpDefMy" resultMap="UpDefMyBaseResultMap">
       Select
       top 10
       a.s_dd --as sDd,---价格创建日期
       ,a.up --as up ,--价格
       ,a.qty --as qty ,--数量
       ,a.unit ---as unit,---单位
       ,a.cur_id ---as curId,----币别代号
       ,b.name ----as curName ----币别名字
       from
       up_def a,
       cur_id b
       where
       a.cur_id=b.cur_id
       and
       a.prd_no=#{prdNo,jdbcType=VARCHAR}
       and
        a.price_id=#{priceId,jdbcType=VARCHAR}
        ORDER BY
        s_dd
    </select>







































</mapper>